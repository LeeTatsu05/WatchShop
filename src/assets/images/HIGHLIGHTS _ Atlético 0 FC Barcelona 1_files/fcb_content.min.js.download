"use strict";PULSE.app.templates["barca-today-items"]=_.template('<li class="barca-today__item js-thumb"> <% if (isContent) { %> <a href="<%= url %>" class="content-today content-today--link content-today--<%= contentType %>"> <% } else { %> <div class="content-today content-today--<%= contentType %>"> <% } %> <picture class="content-today__picture js-lazy-picture"> <% if (typeof photo === \'string\') { %> <img src="" data-image-src="<%= photo %>" alt="<%= contentType + \' photo\' %>" class="content-today__photo"> <% } else {\n                var variants = IMAGE_HELPER.getVariantsForContentType(photo);\n                if ( variants ) {\n                    var imageUrl = IMAGE_HELPER.getPhotoByVariant( variants, \'Standard Article Hero - Mobile\' );\n                    var imageUrlRetina = IMAGE_HELPER.getPhotoByVariant( variants, \'Standard Article Hero - Mobile\' );\n\n                    if ( imageUrl && imageUrlRetina ) { %> <source srcset="" data-image-src="<%= imageUrl.url %>, <%= imageUrlRetina.url %> 2x"> <img src="" data-image-src="<%= imageUrl.url %>" alt="<%= photo.title || \'\' %>" class="content-today__photo"> <% }\n                }\n            } %> </picture> <% if (isContent) { %> <div class="content-today__content-type"> <svg class="content-today__type-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/resources/<%= window.RESOURCE_VERSION %>/i/svg-output/icn.svg#<%= contentType %>"></use></svg> <span class="content-today__type"><%= PULSE.I18N.lookup(\'label.\' + contentType) %></span> </div> <% } else { %> <a href="<%= content.link %>" class="content-today__content-type content-today__content-type--link" target="_blank" rel="noopener"> <svg class="content-today__type-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/resources/<%= window.RESOURCE_VERSION %>/i/svg-output/icn.svg#<%= contentType %>"></use></svg> <span class="content-today__type"><%= content.atChar + content.user.account %></span> </a> <% } %> <div class="content-today__content"> <span class="content-today__title"><%= content.title || content.text || \'\' %></span> </div> <% if (isContent) { %> </div></a> <% } else { %>  <% } %> </li>'),PULSE.app.templates["news-feed-container"]=_.template('<div class="feed__container js-feed-container"> <div class="branding-bar"></div> <div class="feed__date"> <div class="feed__day"><%= date.format(\'dddd\') %></div> <% var dateFormat = PULSE.app.language === \'ja\' ? \'MMMDæ—¥\' : \'MMMM DD\'; %> <div class="feed__month"><%= date.format(dateFormat) %></div> </div> <div class="feed__items js-feed-items"></div> </div>'),PULSE.app.templates["news-feed-empty"]=_.template("<%= PULSE.I18N.lookup( 'label.sorrynocontent' ) %>");var _slicedToArray=function(){function t(t,e){var n=[],a=!0,r=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(a=(i=l.next()).done)&&(n.push(i.value),!e||n.length!==e);a=!0);}catch(s){r=!0,o=s}finally{try{!a&&l["return"]&&l["return"]()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(t,e){var n=20,a="js-barca-today-content",r=function(t){if(t.feedType)return t.feedType;switch(t.type){case"text":return"news";case"video":return"video";case"playlist":return"gallery";default:return""}},o=function(){var t=this,e={contentTypes:"TEXT,VIDEO,PLAYLIST",page:0,pageSize:t.maxLimit,tagExpression:'"'+CONSTANTS.TAGS.TYPE.NEWS.tag+'" or "'+CONSTANTS.TAGS.TYPE.GALLERY.tag+'" or "'+CONSTANTS.TAGS.TYPE.VIDEO.tag+'"'},n=axios.get(URL_HELPER.getMultiContentUrl(e)),a=axios.get(URL_HELPER.getSocialStreamUrl(t.streamId,t.maxLimit));Promise.all([n,a]).then(function(e){var n=_slicedToArray(e,2),a=n[0],r=n[1],o=l(r.data.content),i=a.data.content.concat(o).sort(function(t,e){return e.publishFrom-t.publishFrom});s.call(t,i.slice(0,t.maxLimit))})},i=function(t){if(t.photo)return t.photo;switch(t.type){case"text":return t.leadMedia;case"video":return t.thumbnail;case"playlist":return t.coverItem;default:return""}},l=function(t){var e=t.map(function(t){return SOCIAL_HELPER.getSocialModel(t)});return e.filter(function(t){return t.photo.length>0})},s=function(e){var n=this;if(0!==e.length){var a="";e.forEach(function(t){var e=r(t),o="video"===e||"news"===e||"gallery"===e,l="";if(o){var s="text"===e?n.isFeatured()?"featured":null:t.typeRestriction;l=URL_HELPER.generateUrl(e,t.id,s,t.title,"https",t.tags)}a+=TEMPLATE_HELPER.render({content:t,contentType:e,isContent:o,photo:i(t),url:l},"barca-today-items")}),n.contentContainer.innerHTML=a;for(var o=n.contentContainer.querySelectorAll("."+CONSTANTS.JS_CLS_NAMES.LAZY_PICTURE_ELEMENT),l=0;l<o.length;l++)new t.common.LazyPictureElement(o[l]);new t.ContentSlider(n.container)}};t.BarcaToday=function(t){var r=this;r.container=t,r.contentContainer=r.container.querySelector("."+a),r.maxLimit=Number(r.container.getAttribute("data-maxitems")||n),r.streamId=r.container.getAttribute("data-stream-id"),r.container.addEventListener(CONSTANTS.EVENT.ACTIVATE,o.bind(r)),e.GlobalIntersectionObserver.observe(r.container)};for(var c=document.querySelectorAll('[data-widget="barca-today"]'),d=0;d<c.length;d++)new t.BarcaToday(c[d])}(PULSE.app,PULSE.app.common),function(t,e,n){var a="js-hero-tile",r="is-active";t.CarouselHero=function(e){var n=this;n.container=e,n.tiles=[].slice.call(n.container.querySelectorAll("."+a)),n.setListeners();for(var r=n.container.querySelectorAll("."+CONSTANTS.JS_CLS_NAMES.LAZY_PICTURE_ELEMENT),o=0;o<r.length;o++)new t.common.LazyPictureElement(r[o])},t.CarouselHero.prototype.setActive=function(t){var e=this;e.tiles.forEach(function(t){n.style.removeClass(t,r)}),n.style.addClass(t.currentTarget,r)},t.CarouselHero.prototype.setListeners=function(){for(var t=this,e=0;e<t.tiles.length;e++)t.tiles[e].addEventListener("mouseover",function(e){return t.setActive(e)}),t.tiles[e].addEventListener("focusin",function(e){return t.setActive(e)})};for(var o=document.querySelectorAll('[data-widget="content-hero"]'),i=0;i<o.length;i++)new t.CarouselHero(o[i],{})}(PULSE.app,PULSE.app.common,PULSE.core),function(t,e,n){var a="feed--is-empty",r=function(t){switch(t.type){case"gallery-list":t.listFilter.updateFilters({playlistTypeRestriction:"photo"});break;case"news-feed":t.columnClass="",t.thumbnailClass="thumbnail--wide",t.template="content-news-feed-item";break;case"mixed-content":t.columnClass="col-3 col-6-desk col-12-phab"}},o=function(t){switch(t.type){case"playlist":return"content-gallery-item";case"text":return"content-article-item";case"video":return"";default:return""}},i=function(){var t=this;t.listContainer=null,t.showMoreElement=null,t.filterContainer=null,t.showMoreCheck=!1,t.fetchData=!1,t.pageSize=CONSTANTS.CONTENT_API.DEFAULT_PAGE_SIZE,t.pageSizeLoadMore=null,t.defaultTags=null,t.type=null,t.references=null,t.filter=null,t.columnClass=null,t.gridWidth=null,t.thumbnailClass=null,t.ignoreContent=null,t.additionalConfigClass=null},l=function(t){var e=this;e.listContainer=t.querySelector("[data-content-list]")||e.listContainer,e.showMoreElement=t.querySelector("."+CONSTANTS.JS_CLS_NAMES.SHOW_MORE)||e.showMoreElement,e.filterContainer=t.querySelector("[data-content-filter]")||e.filterContainer,e.showMoreCheck="true"===t.getAttribute("data-show-more")||e.showMoreCheck,e.fetchData="true"===t.getAttribute("data-fetch")||e.fetchData,e.pageSize=Number(t.getAttribute("data-page-size"))||e.pageSize,e.pageSizeLoadMore=Number(t.getAttribute("data-page-size-loadmore"))||e.pageSizeLoadMore,e.defaultTags=t.getAttribute("data-tags")||e.defaultTags,e.type=t.getAttribute("data-type")||e.type,e.references=t.getAttribute("data-references")||e.references,e.filter=t.getAttribute("data-filter")||e.filter,e.gridWidth=t.getAttribute("data-grid-width")||e.gridWidth,e.columnClass=t.getAttribute("data-column-class")||e.columnClass,e.thumbnailClass=t.getAttribute("data-thumbnail-class")||e.thumbnailClass,e.ignoreContent=(t.getAttribute("data-ignore")||"").split(",")||e.ignoreContent,e.additionalConfigClass=t.getAttribute("data-additional-config")||e.additionalConfigClass,e.config.hideIfNoResults=t.getAttribute("data-hide-if-no-results")||e.config.hideIfNoResults||!1},s=function(){var t=this;if(t.additionalConfigClass){var e=document.querySelector(t.additionalConfigClass);e&&l.call(t,e)}},c=function(){var t=this;t.getContentData(!1)};t.ContentList=function(t,n){var a=this;a.element=t,a.config=n||{},i.call(a),l.call(a,a.element),s.call(a);var o={page:0,pageSize:parseInt(a.pageSizeLoadMore||a.pageSize),tagNames:a.defaultTags};a.type&&(o.contentTypes=CONSTANTS.CONTENT_API.MIXED_CONTENT_TYPES),a.listFilter=new e.FilterOptions(o),a.filter&&(a.filterContainer=new e.FilterOptions(a,a.filterContainer)),r(a),a.showMoreCheck&&(a.showMore=new e.ShowMore(a.showMoreElement,{callback:c.bind(a)})),a.fetchData&&a.getContentData(!0)},t.ContentList.prototype.getContentData=function(e){var a=this;e?a.listFilter.updateFilters({page:0}):a.listFilter.updateFilters({page:a.listFilter.get().page+1});var r="";switch(a.type){case"gallery-list":r=t.apiPath.cms.playlist+"?"+n.url.buildQueryString(a.listFilter.get());break;case"news-feed":case"news-list":r=t.apiPath.cms.text+"?"+n.url.buildQueryString(a.listFilter.get());break;case"mixed-content":r=t.apiPath.cms.general+"?"+n.url.buildQueryString(a.listFilter.get())}var o={url:r,callback:function(t){a.render(t,e)},forceCallback:!0,target:a};n.data.manager.add(o)},t.ContentList.prototype.update=function(t){var e=this;switch(t.type){case"FORMAT":"ALL"===t.key?e.listFilter.updateFilters({tagNames:e.defaultTags}):e.listFilter.updateFilters({tagNames:t.key})}e.page=0,e.listFilter.updateFilters({page:0}),e.getContentData(!0)},t.ContentList.prototype.isEmpty=function(){var t=this;return n.style.hasClass(t.listContainer,a)},t.ContentList.prototype.render=function(r,i){var l=this,s={items:[]};"undefined"!=typeof r.content&&r.content.length>0&&(s.items=r.content.map(function(t){return new e.ContentModel(t,{gridWidth:l.gridWidth,columnClass:l.columnClass,thumbnailClass:l.thumbnailClass,template:l.template||o(t)})}),n.style.removeClass(l.listContainer,a)),i&&(l.listContainer.innerHTML="",0===r.content.length&&(n.style.addClass(l.listContainer,a),l.listContainer.innerHTML=TEMPLATE_HELPER.render({},"news-feed-empty"))),s.items.forEach(function(t){l.ignoreContent.includes(t.data.id.toString())||l.listContainer.appendChild(t.element)}),l.config.hideIfNoResults&&0===l.listContainer.children.length?n.style.addClass(l.element,CONSTANTS.STYLE_CLS_NAMES.HIDE):n.style.removeClass(l.element,CONSTANTS.STYLE_CLS_NAMES.HIDE),l.showMore&&l.showMore.setPagination(r.pageInfo),t.common.articleModal&&t.common.articleModal.modal.addThumbListeners(l.listContainer.querySelectorAll("."+CONSTANTS.JS_CLS_NAMES.ARTICLE_MODAL_EXPAND_THUMB)),"function"==typeof l.config.onRenderCallback&&l.config.onRenderCallback(s)};for(var d=document.querySelectorAll('[data-widget="content-list"]'),u=0;u<d.length;u++)new t.ContentList(d[u],{})}(PULSE.app,PULSE.app.common,PULSE.core),function(t){for(var e=document.querySelectorAll('[data-widget="content-trending"]'),n=0;n<e.length;n++)new t.ContentSlider(e[n])}(PULSE.app),function(t,e,n){var a="gallery-featured-widget",r=function(){var t=this;t.container.addEventListener(CONSTANTS.EVENT.ACTIVATE,function(){n.style.addClass(t.container,""+a+CONSTANTS.STYLE_CLS_MODIFIERS.ACTIVE)})};t.FeaturedContentWidget=function(t){var n=this;n.container=t,r.call(n),e.GlobalIntersectionObserver.observe(n.container)};for(var o=document.querySelectorAll('[data-widget="featured-content-widget"]'),i=0;i<o.length;i++)new t.FeaturedContentWidget(o[i],{})}(PULSE.app,PULSE.app.common,PULSE.core,CONSTANTS),function(t,e){t.GalleryAlbum=function(t){new e.GalleryAlbum(t)};for(var n=document.querySelectorAll('[data-widget="gallery-album"]'),a=0;a<n.length;a++)new t.GalleryAlbum(n[a])}(PULSE.app,PULSE.app.common),function(t,e,n){var a="js-thumbnail",r="js-feed-container",o="js-feed-items",i="js-news-feed-filter",l=function(){var t=this,e={threshold:.6};t.intersectionObserver=new IntersectionObserver(function(t){t.forEach(function(t){t.isIntersecting&&n.style.addClass(t.target,CONSTANTS.STYLE_CLS_NAMES.IS_VISIBLE)})},e)},s=function(t){for(var e=this,n=0;n<t.length;n++)e.intersectionObserver.observe(t[n])},c=function(){var e=this;e.filterController&&e.filterController.stopLoading();var n=e.content.querySelectorAll("[data-publish-date]");d.call(e,n),t.common.articleModal&&t.common.articleModal.modal.addThumbListeners(e.content.querySelectorAll("."+CONSTANTS.JS_CLS_NAMES.ARTICLE_MODAL_EXPAND_THUMB)),s.call(e,e.content.querySelectorAll("."+a)),e.contentList.isEmpty()&&e.container.scrollIntoView({behavior:"smooth",block:"start"})},d=function(t){for(var e=this,a=0;a<t.length;a++){var r=moment(Number(t[a].dataset.publishDate)),o=r.format("DD MMMM YYYY");if(o===e.lastDate)u.call(e,t[a]);else{var i=TEMPLATE_HELPER.render({date:r},"news-feed-container");n.dom.appendDomString(e.content,i),u.call(e,t[a]),e.lastDate=o}t[a].removeAttribute("data-publish-date")}},u=function(t){var e=this,n=e.content.querySelector("."+r+":last-of-type");n.querySelector("."+o).appendChild(t)},f=function(t){var e=this;e.contentList.listFilter.updateFilters(t),e.contentList.getContentData(!0),e.filterController.startLoading()},p=function(t){var e=this;t.forEach(function(t){t.intersectionRatio>=PRESET_CONFIG.OBSERVER_CONFIG.threshold?e.filterController.show():e.filterController.hide()})};t.ContentFeed=function(e){var r=this;r.container=e,r.content=r.container.querySelector("[data-content-list]"),r.filters=document.querySelector("."+i),r.lastDate=r.container.getAttribute("data-last-date"),r.widgetEnd=r.container.querySelector(".js-show-more"),r.hideFilters=n.style.hasClass(r.container,"no-filter"),l.call(r),s.call(r,r.container.querySelectorAll("."+a)),!r.hideFilters&&r.filters&&(r.filters=DOM_HELPER.safeInsertAfterNavigation(r.filters)),r.contentList=new t.ContentList(r.container,{onRenderCallback:c.bind(r)}),r.filters&&(r.observer=new IntersectionObserver(p.bind(r),PRESET_CONFIG.OBSERVER_CONFIG),r.observer.observe(r.container),r.filterController=new t.common.FilterController(r.filters,{dropdowns:t.filterData.filters.news,onFilterUpdate:f.bind(r),preventFetch:!0,parentWidget:r.container,type:t.apiPath.cms.text}))};for(var g=document.querySelectorAll('[data-widget="content-feed"]'),m=0;m<g.length;m++)new t.ContentFeed(g[m])}(PULSE.app,PULSE.app.common,PULSE.core);